{% extends 'base.html' %}

{% block title %}组织架构 - HRMS{% endblock %}
{% block page_title %}企业组织架构图{% endblock %}

{% block content %}
<style>
    /* 组织架构图专用样式 - 基于 CSS Tree 方案 */
    .org-tree-container {
        background-color: #f8fafc;
        background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
        background-size: 20px 20px;
        min-height: 600px;
        overflow: auto;
        padding: 40px;
        border-radius: 1rem;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        display: flex;
        justify-content: center;
        align-items: flex-start;
    }

    .org-tree {
        display: table; 
        margin: 0 auto;
    }

    .org-tree ul {
        padding-top: 20px; 
        position: relative;
        transition: all 0.5s;
        display: flex;
        justify-content: center;
        margin: 0;
        padding-left: 0;
    }

    .org-tree li {
        float: left; text-align: center;
        list-style-type: none;
        position: relative;
        padding: 20px 10px 0 10px;
        transition: all 0.5s;
    }

    /* We will use ::before and ::after to draw the connectors */
    .org-tree li::before, .org-tree li::after {
        content: '';
        position: absolute; top: 0; right: 50%;
        border-top: 2px solid #94a3b8;
        width: 50%; height: 20px;
    }
    .org-tree li::after {
        right: auto; left: 50%;
        border-left: 2px solid #94a3b8;
    }

    /* We need to remove left-right connectors from elements without any siblings */
    .org-tree li:only-child::after, .org-tree li:only-child::before {
        display: none;
    }

    /* Remove space from the top of single children */
    .org-tree li:only-child { 
        padding-top: 0;
    }

    /* Remove left connector from first child and right connector from last child */
    .org-tree li:first-child::before, .org-tree li:last-child::after {
        border: 0 none;
    }
    
    /* Adding back the vertical connector to the last nodes */
    .org-tree li:last-child::before {
        border-right: 2px solid #94a3b8;
        border-radius: 0 5px 0 0;
    }
    .org-tree li:first-child::after {
        border-radius: 5px 0 0 0;
    }

    /* Time to add downward connectors from parents */
    .org-tree ul ul::before {
        content: '';
        position: absolute; top: 0; left: 50%;
        border-left: 2px solid #94a3b8;
        width: 0; height: 20px;
        transform: translateX(-1px); /* Center the 2px line */
    }

    /* Node Card Styling */
    .org-node-card {
        background: white;
        border: 1px solid #cbd5e1;
        padding: 12px 16px;
        text-decoration: none;
        color: #334155;
        display: inline-block;
        border-radius: 8px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: all 0.3s;
        position: relative;
        z-index: 10;
        min-width: 140px;
    }

    .org-node-card:hover {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
        border-color: #3b82f6;
    }
    
    /* Different styles for different levels/types */
    .org-node-company {
        background: #eff6ff;
        border-color: #bfdbfe;
    }
    .org-node-department {
        background: #ffffff;
    }
    .org-node-team {
        background: #f8fafc;
        border-style: dashed;
    }

    .node-header {
        font-weight: 600;
        font-size: 0.95rem;
        margin-bottom: 4px;
        color: #1e293b;
    }
    .node-meta {
        font-size: 0.75rem;
        color: #64748b;
    }
    .node-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 8px;
        border-radius: 9999px;
        font-size: 0.7rem;
        margin-top: 8px;
        background-color: #f1f5f9;
        color: #475569;
    }
    .node-badge i {
        color: #3b82f6;
    }
</style>

<div class="bg-white rounded-lg shadow p-6">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-lg font-bold text-gray-800">组织架构全景图</h2>
        <div class="flex gap-2">
            <button onclick="window.print()" class="px-3 py-1.5 text-sm border rounded hover:bg-gray-50">
                <i class="fa-solid fa-print mr-1"></i> 打印/保存
            </button>
        </div>
    </div>

    <div class="org-tree-container">
        <div class="org-tree">
            <ul>
                {% with template_name="organization/tree_node.html" %}
                {% for node in org_tree %}
                    {% include template_name with node=node %}
                {% endfor %}
                {% endwith %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}
